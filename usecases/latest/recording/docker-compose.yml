version: '2'
# Please note that docker-compose does not prescribe a startup order

services:
    #odsupercomponent
    #    odsupercomponent:
    #   image: ${IMAGE}
    #   network_mode: "host"
    #   volumes:
    #   - .:/opt/opendlv.data
    #   user: root
    #   command: "/opt/od4/bin/odsupercomponent --cid=${CID} --verbose=1 --configuration=/opt/opendlv.data/configuration"
        
    proxy-applanix:
        image: ${IMAGE}
        network_mode: "host"
        #   depends_on:
        #    - odsupercomponent
        user: root
        command: "/opt/opendlv.core/bin/opendlv-core-system-proxy-applanix --cid=${CID}"

    #proxy-velodyne32
    velodyne32:
       image: ${IMAGE}
       network_mode: "host"
       volumes:
       - .:/opt/opendlv.data
       ipc: host
       user: root
       working_dir: "/opt/opendlv.data"
       #depends_on:
       #   - odsupercomponent
       command: "/opt/opendlv.core/bin/opendlv-core-system-proxy-velodyne32 --cid=${CID}"

    # Micro-service for proxy-camera-axis0.
    #proxy-camera-axis:
    #  image: ${IMAGE}
    #  depends_on:
    #      - odsupercomponent
    #  environment:
    #       - DISPLAY=$DISPLAY
    #  volumes:
    #     - /tmp/.X11-unix:/tmp/.X11-unix
    #     - .:/opt/opendlv.core.configuration
    #  user: root  # This parameter will be replaced as soon as group_add parameter is available in docker-compose, cf. https://github.com/docker/compose/pull/3709.
    #  network_mode: host
    #  ipc: host
    #  command: "/opt/opendlv.core/bin/opendlv-core-system-proxy-camera-axis --cid=${CID} --freq=20 --id=0"   

    # Micro-service for proxy-camera.
    proxy-camera:
        build: .
        group_add:
            - video
              #        depends_on:
              #- odsupercomponent
        cap_add:
            - SYS_NICE
        devices:
            - "/dev/video0:/dev/video0"
        user: root
        network_mode: host
        ipc: host
        command: "/opt/opendlv.core/bin/opendlv-core-system-proxy-camera --cid=${CID} --freq=20 --realtime=20"
       
    proxy-xc90:
       image: ${IMAGE}
       network_mode: "host"
       privileged: true
       #  depends_on:
       #  - odsupercomponent
       command: "/opt/dlv.snowfox/bin/snowfox-proxy-xc90 --cid=${CID} --freq=100"


